<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS 122 Final Exam Jeopardy Review</title>
    <style>
        /* CSS copied from Midterm-Review-Jeopardy-main.html */
        :root {
            --jeopardy-blue: #060ce9;
            --jeopardy-gold: #ffcc00;
            --dark-bg: #111;
        }

        body {
            font-family: 'Helvetica Neue', sans-serif;
            background-color: var(--dark-bg);
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 10px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        header h1 {
            color: var(--jeopardy-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1.5em;
        }

        #rules-btn {
            background-color: var(--jeopardy-blue);
            color: var(--jeopardy-gold);
            border: 2px solid var(--jeopardy-gold);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        #scoreboard {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .team {
            background-color: #222;
            padding: 15px 25px;
            border-radius: 8px;
            width: 30%;
            transition: box-shadow 0.3s, transform 0.3s;
        }

        .team.active {
            box-shadow: 0 0 20px var(--jeopardy-gold);
            transform: scale(1.05);
        }

        .team-name {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--jeopardy-gold);
        }

        .team-score {
            font-size: 2.5em;
            font-weight: bold;
        }

        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 1fr); /* 10 columns for 10 categories */
            gap: 5px;
            margin: 15px auto;
            max-width: 1800px;
        }

        .category, .clue {
            background-color: var(--jeopardy-blue);
            padding: 8px;
            border-radius: 4px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 60px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            font-weight: bold;
        }

        .category {
            color: #fff;
            text-transform: uppercase;
            font-size: 0.8em;
        }

        .clue {
            color: var(--jeopardy-gold);
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .clue:hover {
            transform: scale(1.05);
        }

        .clue.answered {
            background-color: #333;
            color: #555;
            cursor: not-allowed;
            pointer-events: none;
            font-size: 1.2em;
        }
        
        .code-snippet {
            font-family: monospace;
            background-color: #222;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
            display: inline-block;
            white-space: pre;
            font-size: 0.8em;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background-color: var(--jeopardy-blue);
            padding: 40px;
            border-radius: 10px;
            width: 80%;
            max-width: 900px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            border: 5px solid var(--jeopardy-gold);
        }
        
        #wager-modal h2 {
            font-size: 3em;
            color: var(--jeopardy-gold);
            -webkit-text-stroke: 1px black;
        }
        
        #wager-modal input {
            font-size: 1.5em;
            padding: 10px;
            margin: 10px;
            width: 50%;
            text-align: center;
        }

        #setup-modal input {
            font-size: 1.2em;
            padding: 10px;
            margin: 10px;
            width: 80%;
        }
        
        #rules-modal .modal-content, #setup-modal .modal-content {
            align-items: flex-start;
            text-align: left;
        }

        #rules-modal ul { list-style-type: square; font-size: 1.2em; padding-left: 30px; }
        #rules-modal li { margin-bottom: 15px; }

        #question-text { font-size: 1.8em; margin-bottom: 20px; color: #fff; }
        #answer-text { font-size: 1.6em; margin-top: 20px; color: var(--jeopardy-gold); font-weight: bold; }

        .hidden { display: none !important; }

        .modal-content button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background-color: var(--jeopardy-gold);
            color: #000;
            font-weight: bold;
        }
        
        #correct-btn { background-color: #28a745; color: white; }
        #incorrect-btn { background-color: #dc3545; color: white; }
    </style>
</head>
<body>

    <header>
        <h1>CS 122 FINAL EXAM REVIEW (LEC 10-17)</h1>
        <button id="rules-btn">Game Rules</button>
    </header>

    <div id="scoreboard">
        <div id="team1" class="team">
            <div id="team1-name" class="team-name">Team 1</div>
            <div id="team1-score" class="team-score">0</div>
        </div>
        <div id="team2" class="team">
            <div id="team2-name" class="team-name">Team 2</div>
            <div id="team2-score" class="team-score">0</div>
        </div>
    </div>

    <div id="game-board"></div>
    
    <div id="question-modal" class="modal">
        <div class="modal-content">
            <div id="question-text"></div>
            <div id="pre-reveal-btns">
                <button id="reveal-answer-btn">Reveal Answer</button>
                <button id="cancel-question-btn">Cancel</button>
            </div>
            <div id="answer-text" class="hidden"></div>
            <div id="post-reveal-btns" class="hidden">
                <button id="correct-btn">Correct</button>
                <button id="incorrect-btn">Incorrect</button>
            </div>
        </div>
    </div>

    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--jeopardy-gold); text-align: center; width: 100%;">Jeopardy Rules</h2>
            <ul>
                <li>The class will be divided into two teams.</li>
                <li>The active team selects a category and a point value.</li>
                <li>After the answer is revealed, the team responds.</li>
                <li>If the response is correct, the team earns the point value and keeps control.</li>
                <li>If the response is incorrect, the team loses the point value and control passes to the other team.</li>
                <li>**Daily Doubles:** If a Daily Double is found, the team must wager an amount before seeing the question. A correct answer wins the wager, an incorrect answer loses it. (There are 3 Daily Doubles on this board).</li>
            </ul>
            <button id="close-rules-btn">Close</button>
        </div>
    </div>
    
    <div id="wager-modal" class="modal">
        <div class="modal-content">
            <h2>DAILY DOUBLE!</h2>
            <p id="max-wager-text">Max wager: 1000</p>
            <input type="number" id="wager-input" placeholder="Enter your wager">
            <button id="lock-wager-btn">Lock In Wager</button>
        </div>
    </div>

    <div id="setup-modal" class="modal" style="display: flex;">
        <div class="modal-content">
            <h2 style="color: var(--jeopardy-gold); text-align: center; width: 100%;">Enter Team Names</h2>
            <input type="text" id="team1-input" placeholder="Enter Team 1 Name" value="Team 1">
            <input type="text" id="team2-input" placeholder="Enter Team 2 Name" value="Team 2">
            <button id="start-game-btn">Start Game</button>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            /* Questions are strictly aligned to the Final Study Guide Sections */
            const gameData = [
                // Category 1: Collections Framework & ArrayList
                {
                    category: "ArrayList",
                    questions: [
                        { points: 100, answer: "The operation that automatically turns a primitive `int` into an `Integer` object for storage in a Collection.", question: "What is **autoboxing**?" },
                        { points: 200, answer: "The time required to retrieve an element by index (`.get(i)`) for an `ArrayList`.", question: "What is **O(1)**?" },
                        { points: 300, answer: "The reason **ArrayList** is called a 'resizable array'.", question: "What is it creates a **larger internal array and copies everything over**?" },
                        { points: 400, answer: "The amount of time required to shift elements when calling `.remove(500)` on an `ArrayList` of 1000 items.", question: "What is **O(n)**?" },
                        { points: 500, answer: "The specific error that generics (`<String>`) prevent.", question: "What is trying to add an **incorrect type** (e.g., Integer to `ArrayList<String>`)?" },
                        { points: 600, answer: "The cleaner and less error-prone way to iterate over any Collection.", question: "What is the **for-each loop**?" },
                        { points: 700, answer: "The final output: <br><code class='code-snippet'>ArrayList<Integer> nums = new ArrayList<>();<br>nums.add(1); nums.add(2);<br>System.out.println(nums);</code>", question: "What is **[1, 2]**?" },
                        { points: 800, answer: "The name for Java's toolkit of reusable, optimized data structures.", question: "What is the **Collections Framework**?" },
                        { points: 900, answer: "The method that allows an `ArrayList` to display all its elements when printed directly to the console.", question: "What is **`.toString()`**?" }
                    ]
                },
                // Category 2: LinkedList and Performance Analysis
                {
                    category: "LinkedList",
                    questions: [
                        { points: 100, answer: "The structure that links elements, containing both data and links to the next and previous elements.", question: "What is a **doubly-linked list**?" },
                        { points: 200, answer: "The list type that is faster (O(1)) for inserting elements at the beginning.", question: "What is **LinkedList**?" },
                        { points: 300, answer: "The amount of time required to access an element by index (`.get(i)`) on a `LinkedList`.", question: "What is **O(n)**?" },
                        { points: 400, answer: "The list type to choose when you frequently access elements by index.", question: "What is **ArrayList**?" },
                        { points: 500, answer: "The result of using an index-based loop (`.get(i)`) on a large `LinkedList`.", question: "What is the **O(nÂ²) complexity problem**?" },
                        { points: 600, answer: "The object used by the for-each loop to ensure sequential traversal of a `LinkedList` is $O(n)$.", question: "What is an **Iterator**?" },
                        { points: 700, answer: "The `LinkedList` method used to remove and return the element from the end of the list.", question: "What is **`.removeLast()`**?" },
                        { points: 800, answer: "The primary **trade-off** where `LinkedList` excels.", question: "What is **frequent adding/removing in the middle**?" },
                        { points: 900, answer: "The final output: <br><code class='code-snippet'>LinkedList<String> list = new LinkedList<>();<br>list.add('C'); list.add('A'); list.addFirst('B');<br>System.out.println(list.getFirst());</code>", question: "What is **B**?" }
                    ]
                },
                // Category 3: 12. Sets and Queues
                {
                    category: "Sets & Queues",
                    questions: [
                        { points: 100, answer: "The primary guarantee of the **Set** interface.", question: "What is **uniqueness** (or no duplicates)?" },
                        { points: 200, answer: "The required time to check if an item exists in a `HashSet`.", question: "What is **O(1) average**?" },
                        { points: 300, answer: "The ordering principle of a **Queue**.", question: "What is **FIFO** (First-In-First-Out)?" },
                        { points: 400, answer: "The consequence of calling `.add()` with a duplicate element on a `HashSet`.", question: "What is **it is silently ignored**?" },
                        { points: 500, answer: "The specific `Set` implementation that is **fast** but provides **no guaranteed order**.", question: "What is **HashSet**?" },
                        { points: 600, answer: "The `Queue` method that **throws an exception** if the queue is full.", question: "What is **`.add(object)`**?" },
                        { points: 700, answer: "The method on `ArrayBlockingQueue` that causes a thread to **pause** if the queue is full.", question: "What is **`.put()`**?" },
                        { points: 800, answer: "The specific, thread-safe queue that blocks if full or empty.", question: "What is **`ArrayBlockingQueue`**?" },
                        { points: 900, answer: "The final output: <br><code class='code-snippet'>Queue<String> orders = new LinkedList<>();<br>orders.add('A'); orders.add('B');<br>orders.remove();<br>System.out.println(orders.poll());</code>", question: "What is **B**?" }
                    ]
                },
                // Category 4: Maps as Lookup Tables
                {
                    category: "Maps",
                    questions: [
                        { points: 100, answer: "The collection structure that stores information as **key-value pairs**.", question: "What is a **Map**?" },
                        { points: 200, answer: "The required time for retrieving a value by key in a `HashMap`.", question: "What is **O(1) average**?" },
                        { points: 300, answer: "The consequence of calling `.put()` with a key that already exists.", question: "What is the **old value is overwritten**?" },
                        { points: 400, answer: "The method used to retrieve a **Set** of all the unique keys in a `HashMap`.", question: "What is **`.keySet()`**?" },
                        { points: 500, answer: "The most efficient way to iterate through both the keys and values of a `HashMap`.", question: "What is **iterating over the `entrySet()`**?" },
                        { points: 600, answer: "The real-world technique where a Map is used to avoid repeated slow network calls.", question: "What is **caching**?" },
                        { points: 700, answer: "The requirement for any custom object used as a **key** in a `HashMap`.", question: "What is it must have a proper **`hashCode()`** method?" },
                        { points: 800, answer: "The final output: <br><code class='code-snippet'>HashMap<String, Integer> map = new HashMap<>();<br>map.put('X', 10);<br>map.remove('Y');<br>System.out.println(map.size());</code>", question: "What is **1**?" },
                        { points: 900, answer: "The final output: <br><code class='code-snippet'>HashMap<String, String> data = new HashMap<>();<br>data.put('A', 'X');<br>data.put('A', 'Y');<br>System.out.println(data.get('A'));</code>", question: "What is **Y**?" }
                    ]
                },
                // Category 5: Binary Search: Efficient Searching
                {
                    category: "Binary Search",
                    questions: [
                        { points: 100, answer: "The **critical prerequisite** for using binary search.", question: "What is the **array/list must be sorted**?" },
                        { points: 200, answer: "The search algorithm that is $O(n)$.", question: "What is **Linear Search**?" },
                        { points: 300, answer: "The number of comparisons required for a binary search on $1,000,000$ elements.", question: "What are **approximately 20** comparisons?" },
                        { points: 400, answer: "The action taken if the target value is **less than** the value at the `middle` index.", question: "What is **set `right = middle - 1`**?" },
                        { points: 500, answer: "The amount of time required for the entire process: sort + binary search + binary search.", question: "What is **O(n log n)**?" },
                        { points: 600, answer: "The reason to use $left + (right - left) / 2$ to calculate the middle index.", question: "What is to **avoid integer overflow** on very large numbers?" },
                        { points: 700, answer: "The value the binary search function must return if the loop condition `while (left <= right)` becomes false.", question: "What is **-1** (or not found)?" },
                        { points: 800, answer: "The number of elements the search space is reduced by in each step.", question: "What is **half** (or 50%)?" },
                        { points: 900, answer: "The value of `middle` in a binary search on an array of length 11, with `left = 0` and `right = 10`.", question: "What is **5**?" }
                    ]
                },
                // Category 6: Exception Handling & Recovery
                {
                    category: "Exceptions",
                    questions: [
                        { points: 100, answer: "The keyword used to wrap code that might throw an exception.", question: "What is **`try`**?" },
                        { points: 200, answer: "The block of code that **always** executes, useful for closing files.", question: "What is **`finally`**?" },
                        { points: 300, answer: "The keyword that delegates exception handling responsibility to the calling method.", question: "What is **`throws`**?" },
                        { points: 400, answer: "The type of exception (`IOException`) that the compiler forces you to handle.", question: "What is a **checked exception**?" },
                        { points: 500, answer: "The type of exception (`NullPointerException`) caused by programming errors.", question: "What is an **unchecked exception**?" },
                        { points: 600, answer: "The exception object method used to print the full history of method calls for debugging.", question: "What is **`.printStackTrace()`**?" },
                        { points: 700, answer: "The rule for ordering `catch` blocks when handling exceptions.", question: "What is **specific exceptions must come before general ones**?" },
                        { points: 800, answer: "The primary difference between an Exception and an Error in Java.", question: "What is **you handle exceptions but don't handle errors**?" },
                        { points: 900, answer: "The final output: <br><code class='code-snippet'>try {<br>  // No exception thrown<br>} finally {<br>  System.out.println('Cleaned');<br>}</code>", question: "What is **Cleaned**?" }
                    ]
                },
                // Category 7: File Input/Output Operations
                {
                    category: "File I/O",
                    questions: [
                        { points: 100, answer: "The core class that represents a file or directory path.", question: "What is the **`File`** class?" },
                        { points: 200, answer: "The method that must be called on a file writer to ensure data is written to the disk.", question: "What is **`.close()`**?" },
                        { points: 300, answer: "The most efficient class for reading a text file line by line.", question: "What is **`BufferedReader`**?" },
                        { points: 400, answer: "The value returned by `BufferedReader`'s `.readLine()` when it reaches the end of the file.", question: "What is **`null`**?" },
                        { points: 500, answer: "The parameter used in the `FileWriter` constructor to **append** text instead of overwriting.", question: "What is **`true`** (as the second argument to the constructor)?" },
                        { points: 600, answer: "The file path type that starts from the root of the file system.", question: "What is an **absolute path**?" },
                        { points: 700, answer: "The class that wraps a `FileWriter` to make writing large amounts of data faster.", question: "What is **`BufferedWriter`**?" },
                        { points: 800, answer: "The `File` method that creates a directory.", question: "What is **`.mkdir()`**?" },
                        { points: 900, answer: "The specific checked exception thrown if a file cannot be found.", question: "What is **`FileNotFoundException`**?" }
                    ]
                },
                // Category 8: Recursion
                {
                    category: "Recursion",
                    questions: [
                        { points: 100, answer: "The condition that stops the chain of recursive calls.", question: "What is the **base case**?" },
                        { points: 200, answer: "The two parts required for every recursive method.", question: "What are the **base case** and the **recursive case**?" },
                        { points: 300, answer: "The recursive step for the **Factorial** function for $n>1$.", question: "What is **`return n * factorial(n - 1)`**?" },
                        { points: 400, answer: "The final output of the Factorial recursive function when given an input of 5.", question: "What is **120**?" },
                        { points: 500, answer: "The problem that results from a missing or faulty base case.", question: "What is **infinite recursion** (or Stack Overflow)?" },
                        { points: 600, answer: "The type of time complexity for the naive recursive **Fibonacci** function.", question: "What is **exponential** (or $O(2^n)$)?" },
                        { points: 700, answer: "The alternative approach, usually more performant, that should be considered for any recursive problem.", question: "What is **iteration** (or using loops)?" },
                        { points: 800, answer: "The final output: <br><code class='code-snippet'>public static int bad(int n) {<br>  return bad(n - 1);<br>}</code>", question: "What is a **crash** (or Stack Overflow)?" },
                        { points: 900, answer: "The final output of the Fibonacci recursive function when given input 3.", question: "What is **2**?" }
                    ]
                },
                // Category 9: Testing with JUnit
                {
                    category: "JUnit Testing",
                    questions: [
                        { points: 100, answer: "The automated testing framework used in Java.", question: "What is **JUnit 5**?" },
                        { points: 200, answer: "The annotation that marks a method as an official test method.", question: "What is **`@Test`**?" },
                        { points: 300, answer: "The assertion method used to verify that two values are equal.", question: "What is **`assertEquals()`**?" },
                        { points: 400, answer: "The type of input used to test boundaries, such as 0 or negative numbers.", question: "What are **edge cases**?" },
                        { points: 500, answer: "The assertion method used to verify that a specific exception is thrown.", question: "What is **`assertThrows()`**?" },
                        { points: 600, answer: "The convention for naming a JUnit test method.", question: "What is **`methodUnderTest_expectedBehavior_conditions`**?" },
                        { points: 700, answer: "The advantage of automated testing over manual testing.", question: "What is **running hundreds of tests in seconds** (or systematic verification)?" },
                        { points: 800, answer: "The method used to verify that a file was successfully created in a file I/O test.", question: "What is **`assertTrue(file.exists())`**?" },
                        { points: 900, answer: "The final output: <br><code class='code-snippet'>@Test public void test() {<br>  assertFalse(5 < 0);<br>}</code>", question: "What is **(the test) passes**?" }
                    ]
                },
                // Category 10: Trail Mix
                {
                    category: "Trail Mix",
                    questions: [
                        { points: 100, answer: "The data structure that efficiently removes duplicates from an `ArrayList`.", question: "What is **HashSet**?" },
                        { points: 200, answer: "The three holistic concepts assessed in the final exam's **Programming Challenge** section.", question: "What are **reading files into collections**, **handling exceptions**, and **writing recursive algorithms**?" },
                        { points: 300, answer: "The list type and operation that results in $O(n^2)$ search performance.", question: "What is **LinkedList with index-based `get(i)`**?" },
                        { points: 400, answer: "The correct search approach for finding a name in a **sorted `ArrayList`** of 1,000,000 strings.", question: "What is **Binary Search**?" },
                        { points: 500, answer: "The purpose of placing a file `.close()` call inside a **`finally`** block during file writing.", question: "What is to **ensure the resource is released** (or closed) **even if an exception occurs**?" },
                        { points: 600, answer: "The specific exception that a **binary search** on an array might throw if the search boundaries are improperly calculated.", question: "What is **`ArrayIndexOutOfBoundsException`**?" },
                        { points: 700, answer: "The best stream class to use for efficiently reading a text file line-by-line into a **HashMap**.", question: "What is **`BufferedReader`**?" },
                        { points: 800, answer: "The assertion method needed to test that `factorial(0)` returns the correct result.", question: "What is **`assertEquals()`**?" },
                        { points: 900, answer: "The data structure required to store unique student IDs (Integer) mapped to their names (String).", question: "What is **HashMap<Integer, String>**?" }
                    ]
                }
            ];

            // --- State Variables ---
            let teams = [ { name: "Team 1", score: 0 }, { name: "Team 2", score: 0 } ];
            let activeTeamIndex = 0;
            let currentQuestionValue = 0;
            let activeClue = null;
            
            // --- Get DOM Elements ---
            const gameBoard = document.getElementById('game-board');
            const questionModal = document.getElementById('question-modal');
            const questionText = document.getElementById('question-text');
            const answerText = document.getElementById('answer-text');
            const revealAnswerBtn = document.getElementById('reveal-answer-btn');
            const cancelQuestionBtn = document.getElementById('cancel-question-btn');
            const correctBtn = document.getElementById('correct-btn');
            const incorrectBtn = document.getElementById('incorrect-btn');
            const preRevealBtns = document.getElementById('pre-reveal-btns');
            const postRevealBtns = document.getElementById('post-reveal-btns');
            const rulesBtn = document.getElementById('rules-btn');
            const rulesModal = document.getElementById('rules-modal');
            const closeRulesBtn = document.getElementById('close-rules-btn');
            const setupModal = document.getElementById('setup-modal');
            const startGameBtn = document.getElementById('start-game-btn');
            const wagerModal = document.getElementById('wager-modal');
            const maxWagerText = document.getElementById('max-wager-text');
            const wagerInput = document.getElementById('wager-input');
            const lockWagerBtn = document.getElementById('lock-wager-btn');

            // --- Functions ---
            function updateScoreboard() {
                document.getElementById('team1-name').textContent = teams[0].name;
                document.getElementById('team1-score').textContent = teams[0].score;
                document.getElementById('team2-name').textContent = teams[1].name;
                document.getElementById('team2-score').textContent = teams[1].score;
                document.getElementById('team1').classList.remove('active');
                document.getElementById('team2').classList.remove('active');
                document.getElementById(`team${activeTeamIndex + 1}`).classList.add('active');
            }

            function setupBoard() {
                gameBoard.innerHTML = '';
                // Add categories (first row)
                gameData.forEach((cat) => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('category');
                    categoryDiv.textContent = cat.category;
                    gameBoard.appendChild(categoryDiv);
                });
                // Add clues (9 rows below categories)
                for (let i = 0; i < 9; i++) {
                    gameData.forEach((cat, catIndex) => {
                        const clue = cat.questions[i];
                        const clueDiv = document.createElement('div');
                        clueDiv.classList.add('clue');
                        // Use original points: 100, 200, 300, 400, 500, 600, 700, 800, 900
                        const points = (i + 1) * 100; 
                        clueDiv.textContent = `$${points}`;
                        clueDiv.dataset.catIndex = catIndex;
                        clueDiv.dataset.clueIndex = i;
                        clueDiv.dataset.points = points;
                        
                        // Manually assign 3 Daily Doubles for the full 10-category board:
                        if (catIndex === 3 && points === 800) { clue.dailyDouble = true; } // L13: Maps $800
                        if (catIndex === 5 && points === 900) { clue.dailyDouble = true; } // L15: Exceptions $900
                        if (catIndex === 7 && points === 400) { clue.dailyDouble = true; } // L17: Recursion $400
                        
                        if (clue.dailyDouble) {
                            clueDiv.dataset.dailyDouble = 'true';
                        }

                        gameBoard.appendChild(clueDiv);
                    });
                }
            }
            
            function showQuestionModal() {
                const { catIndex, clueIndex } = activeClue.dataset;
                const questionData = gameData[catIndex].questions[clueIndex];
                questionText.innerHTML = questionData.answer;
                answerText.innerHTML = questionData.question;
                answerText.classList.add('hidden');
                preRevealBtns.classList.remove('hidden');
                postRevealBtns.classList.add('hidden');
                questionModal.style.display = 'flex';
            }
            
            function closeQuestion(markAsDone) {
                questionModal.style.display = 'none';
                if (activeClue && markAsDone) {
                    activeClue.classList.add('answered');
                    activeClue.textContent = 'DONE';
                }
                activeClue = null;
            }

            // --- Event Listeners ---
            startGameBtn.addEventListener('click', () => {
                teams[0].name = document.getElementById('team1-input').value.trim() || "Team 1";
                teams[1].name = document.getElementById('team2-input').value.trim() || "Team 2";
                setupModal.style.display = 'none';
                updateScoreboard();
            });
            
            gameBoard.addEventListener('click', (e) => {
                const clueElement = e.target;
                if (clueElement.classList.contains('clue') && !clueElement.classList.contains('answered')) {
                    activeClue = clueElement;
                    const { catIndex, clueIndex } = activeClue.dataset;
                    const questionData = gameData[catIndex].questions[clueIndex];

                    if (questionData.dailyDouble) {
                        // Max wager is the team's current score OR $900 (the highest default value on the board), whichever is greater.
                        const maxWager = Math.max(teams[activeTeamIndex].score, 900);
                        maxWagerText.textContent = `Max wager: $${maxWager}`;
                        wagerInput.value = '';
                        wagerInput.max = maxWager;
                        wagerModal.style.display = 'flex';
                    } else {
                        currentQuestionValue = parseInt(activeClue.dataset.points);
                        showQuestionModal();
                    }
                }
            });
            
            lockWagerBtn.addEventListener('click', () => {
                const maxWager = parseInt(wagerInput.max);
                const wager = parseInt(wagerInput.value);
                if (isNaN(wager) || wager < 5 || wager > maxWager) {
                    alert(`Invalid wager. Please enter a number between 5 and ${maxWager}.`);
                    return;
                }
                currentQuestionValue = wager;
                wagerModal.style.display = 'none';
                showQuestionModal();
            });

            revealAnswerBtn.addEventListener('click', () => {
                answerText.classList.remove('hidden');
                preRevealBtns.classList.add('hidden');
                postRevealBtns.classList.remove('hidden');
            });
            
            cancelQuestionBtn.addEventListener('click', () => { closeQuestion(false); });

            correctBtn.addEventListener('click', () => {
                teams[activeTeamIndex].score += currentQuestionValue;
                updateScoreboard();
                closeQuestion(true);
            });

            incorrectBtn.addEventListener('click', () => {
                teams[activeTeamIndex].score -= currentQuestionValue;
                activeTeamIndex = (activeTeamIndex + 1) % 2;
                updateScoreboard();
                closeQuestion(true);
            });

            rulesBtn.addEventListener('click', () => { rulesModal.style.display = 'flex'; });
            closeRulesBtn.addEventListener('click', () => { rulesModal.style.display = 'none'; });

            // --- Initialize ---
            setupBoard();
            updateScoreboard();
        });
    </script>
</body>
</html>